<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSDoc: Source: api/speech.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link
      type="text/css"
      rel="stylesheet"
      href="styles/prettify-tomorrow.css"
    />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>

  <body>
    <div id="main">
      <h1 class="page-title">Source: api/speech.js</h1>

      <section>
        <article>
          <pre class="prettyprint source linenums"><code>'use strict';

const speech = require('@google-cloud/speech');

let client = new speech.SpeechClient();
const record = require('node-record-lpcm16');

const events = require('../../modules/events.js');
require('../check-data.js');
require('../check-command.js');
require('../light-listen');


const encoding = 'LINEAR16';
const sampleRateHertz = 16000;
const languageCode = 'en-US';


let dataArr = [];
let parsedString = [];
const magVariants = ['hey magpie', 'a magpie', 'hey McFly','hey man cry', 'play magpie', 'play Mac Dre', 'hey Meg big fat guy', 'magpie'];

const request = {
  config: {
    encoding: encoding,
    sampleRateHertz: sampleRateHertz,
    languageCode: languageCode,
  },
  interimResults: false, 
};

const recognizeStream = client
  .streamingRecognize(request)
  .on('error', console.error)
  .on('data', handleData);

/**
 * @function listen listens for user input and emits 
 * @fires blue-on when user says 'MagPi'
 * @fires 'blue-flash'
 * @param {*} arr
 */
function listen(arr) {
  if(magVariants.includes(arr[0])){
    if(arr.length === 1){
      events.emit('blue-on');
    }
    if(arr[1]){
      if(arr.length === 2){
      events.emit('check-command', arr);
      }
    if(arr[2]) {
      events.emit('blue-flash');
      events.emit('blue-on');
    }
    if(arr[3]){
      events.emit('check-data', arr);
    }
    } 
  }
}


/**
 * @function handleData empties the array appropriatly as user continues to give input
 * @param {*} data
 */
function handleData (data){
  if(data.results[0] &amp;&amp; data.results[0].alternatives[0]) {
    dataArr.push(data.results[0].alternatives[0].transcript.trim());       
    listen(dataArr);
  }

  events.on('send-list', ()=>{
    dataArr=[];
  })
            
  if(dataArr.length > 3){
    dataArr = [];
  }
    
  if(!magVariants.includes(dataArr[0]) ) {
    dataArr = [];
  }
}
  

// Start recording and send the microphone input to the Speech API
record
.start({
  sampleRateHertz: sampleRateHertz,
  threshold: 0,
  verbose: false,
  recordProgram: 'rec', // Try also "arecord" or "sudo apt"
  silence: '10.0',
  //device: 'plughw:1',
})
.on('error', console.error)
.pipe(recognizeStream);

console.log('Listening, press Ctrl+C to stop.');


</code></pre>
        </article>
      </section>
    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Modules</h3>
      <ul>
        <li><a href="module-src_app.html">src/app</a></li>
        <li><a href="module-src_check-commands.html">src/check-commands</a></li>
        <li><a href="module-src_check-data.html">src/check-data</a></li>
      </ul>
      <h3>Classes</h3>
      <ul>
        <li><a href="module-src_check-data-ListMaker.html">ListMaker</a></li>
      </ul>
      <h3>Global</h3>
      <ul>
        <li>
          <a
            href="global.html#handleDataemptiesthearrayappropriatlyasusercontinuestogiveinput"
            >handleData empties the array appropriatly as user continues to give
            input</a
          >
        </li>
        <li>
          <a href="global.html#listenlistensforuserinputandemits"
            >listen listens for user input and emits</a
          >
        </li>
      </ul>
    </nav>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jan 24
      2019 12:15:53 GMT-0800 (Pacific Standard Time)
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
